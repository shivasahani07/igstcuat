<apex:page controller="IGSTCSupportCaseController"
           sidebar="false"
           showHeader="false"
           standardStylesheets="false"
           docType="html-5.0">

<!-- CKEditor -->
<script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

<style>   

    body {
    font-family: Arial, sans-serif;
    background: #f4f6f9;
}

.header {
    background: #1f3b6f;
    color: #fff;
    padding: 16px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
}

.container {
    max-width: 700px;
    margin: 30px auto;
    background: #fff;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

/* ðŸ”¹ FORM GROUP */
.form-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 18px;
}

.form-group label {
    font-weight: 600;
    margin-bottom: 6px;
    color: #333;
}

/* ðŸ”¹ INPUT STYLING */
.form-group input,
.form-group textarea {
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid #c9ccd3;
    font-size: 14px;
    transition: all 0.2s ease;
    background: #fff;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #1f3b6f;
    box-shadow: 0 0 0 2px rgba(31,59,111,0.15);
}

.btn {
    background: #1f3b6f;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 15px;
    cursor: pointer;
    border-radius: 6px;
}

.btn:disabled {
    background: #999;
    cursor: not-allowed;
}

.spinner {
    display: none;
    margin-top: 15px;
    font-weight: bold;
    text-align: center;
}

.message {
    margin-top: 15px;
    font-weight: bold;
    text-align: center;
}

.success { color: #2e7d32; }
.error { color: #c62828; }

</style>

<div class="header">IGSTC SUPPORT</div>

<div class="container">

    <div class="form-group">
        <label>Name *</label>
        <input type="text" id="name"/>
    </div>

    <div class="form-group">
        <label>Email *</label>
        <input type="email" id="email"/>
    </div>

    <div class="form-group">
        <label>Comment *</label>
        <textarea id="comment" style="min-height:160px;"></textarea>
    </div>

    <div class="form-group">
        <label>Proposal Number</label>
        <input type="text" id="proposalId"/>
    </div>

    <button id="submitBtn" class="btn" onclick="submitCase()">Submit</button>

    <div id="spinner" class="spinner">Submitting...</div>
    <div id="message" class="message"></div>

</div>

<!-- <script>
    // Initialize CKEditor
    CKEDITOR.replace('comment');

    function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function submitCase() {
        var name = document.getElementById('name').value.trim();
        var email = document.getElementById('email').value.trim();
        var comment = CKEDITOR.instances.comment.getData();
        var proposalId = document.getElementById('proposalId').value.trim();

        if (!name || !email || !comment) {
            showMessage('Please fill all mandatory fields.', 'error');
            return;
        }

        if (!isValidEmail(email)) {
            showMessage('Please enter a valid email address.', 'error');
            return;
        }

        toggleLoading(true);

        // Visualforce.remoting.Manager.invokeAction(
        //     '{!$RemoteAction.IGSTCSupportCaseController.createCase}',
        //     name,
        //     email,
        //     comment,
        //     proposalId,
        //     function(result, event) {
        //         toggleLoading(false);

        //         if (event.status && result === 'SUCCESS') {
        //             showMessage('Support request submitted successfully.', 'success');
        //             resetForm();
        //         } else {
        //             showMessage(result.replace('ERROR:', ''), 'error');
        //         }
        //     }
        // );
    }

    function toggleLoading(isLoading) {
        document.getElementById('spinner').style.display = isLoading ? 'block' : 'none';
        document.getElementById('submitBtn').disabled = isLoading;
    }

    function showMessage(msg, type) {
        var el = document.getElementById('message');
        el.innerHTML = msg;
        el.className = 'message ' + type;
    }

    function resetForm() {
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('proposalId').value = '';
        CKEDITOR.instances.comment.setData('');
    }
</script> -->
<script>
   // CKEDITOR.replace('comment');
    // function isValidEmail(email) {
    //     return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    // }

    function submitCase() {
        var payload = {
            name: document.getElementById('name').value.trim(),
            email: document.getElementById('email').value.trim(),
          //  comment: CKEDITOR.instances.comment.getData(),
            comment:document.getElementById('comment').value.trim(),
            proposalId: document.getElementById('proposalId').value.trim()
        };

        if (!payload.name || !payload.email || !payload.comment) {
            showMessage('Please fill all mandatory fields.', 'error');
            return;
        }

         // âœ… Email format validation
        // if (!isValidEmail(payload.email)) {
        //     showMessage('Please enter a valid email address.', 'error');
        //     return;
        // }

       
        toggleLoading(true);

        // SEND DATA TO PARENT PAGE
        window.parent.postMessage({
            type: 'IGSTC_SUPPORT_SUBMIT',
            data: payload
        }, '*');
    }
    

    window.addEventListener('message', function(event) {
            if (!event.data || event.data.type !== 'IGSTC_SUPPORT_RESPONSE') return;

            toggleLoading(false);

            if (event.data.success) {
                // ðŸ”” Notify parent to close modal + show toast
                window.parent.postMessage({
                    type: 'IGSTC_SUPPORT_SUCCESS'
                }, '*');

                resetForm();
            } else {
                // Still show error inside iframe
                showMessage(event.data.message, 'error');
            }
        });

    function toggleLoading(isLoading) {
        document.getElementById('spinner').style.display = isLoading ? 'block' : 'none';
        document.getElementById('submitBtn').disabled = isLoading;
    }

    function showMessage(msg, type) {
        var el = document.getElementById('message');
        el.innerHTML = msg;
        el.className = 'message ' + type;
    }

    function resetForm() {
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('proposalId').value = '';
        document.getElementById('comment').value = '';
        //CKEDITOR.instances.comment.setData('');
    }
</script>

</apex:page>